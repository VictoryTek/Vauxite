# Install Cosmic Desktop Environment
type: rpm-ostree
install:
  # Cosmic Desktop Core
  - cosmic-desktop
  - cosmic-workspaces-daemon
  - cosmic-launcher
  - cosmic-panel
  - cosmic-settings
  - cosmic-applets
  - cosmic-session
  - cosmic-greeter
  
  # Additional components
  - cosmic-icontheme
  - cosmic-terminal
  - cosmic-files
  - cosmic-settings-daemon
  - cosmic-design
  - cosmic-screenshot
  - cosmic-applibrary
  - cosmic-notifications
  
  # Dependencies
  - xdg-desktop-portal-cosmic
  
  # Additional apps that work well with Cosmic
  - popshop
  - firefox
  - gnome-disk-utility
  - libhandy  # For GTK apps integration

# Set Cosmic as the default desktop
postprocess:
  - |
    #!/bin/bash
    # Enable cosmic-greeter service
    systemctl enable cosmic-greeter.service
    
    # Set Cosmic as the default session
    mkdir -p /etc/skel/.config
    
    # Configure default desktop session
    if [ -d /var/lib/AccountsService/users/ ]; then
      for user in /var/lib/AccountsService/users/*; do
        if [ -f "$user" ]; then
          # Check if Session line exists
          if grep -q "^Session=" "$user"; then
            sed -i 's/^Session=.*/Session=cosmic/' "$user"
          else
            echo "Session=cosmic" >> "$user"
          fi
        fi
      done
    else
      mkdir -p /var/lib/AccountsService/users/
    fi
    
    # Create default user if it doesn't exist
    if [ ! -f /var/lib/AccountsService/users/gdm ]; then
      echo "[User]" > /var/lib/AccountsService/users/gdm
      echo "Session=cosmic" >> /var/lib/AccountsService/users/gdm
    fi
