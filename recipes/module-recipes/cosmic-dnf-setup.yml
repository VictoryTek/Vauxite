---
# yaml-language-server: $schema=https://schema.blue-build.org/module-v1.json
type: script
script: |
  #!/bin/bash
  
  # Enable the COPR repository for COSMIC Desktop Environment
  dnf -y copr enable @system76/cosmic
  
  # Sync dnf repositories
  dnf makecache
  
  # Set up group install capability (if needed for cosmic-desktop group)
  # This is a workaround in case the group definition is not properly set up
  if ! dnf group list "Cosmic Desktop" &>/dev/null; then
    echo "Creating Cosmic Desktop group manually..."
    
    # Create a temporary group file
    cat > /tmp/cosmic-group.xml <<EOF
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE comps PUBLIC "-//Red Hat, Inc.//DTD Comps info//EN" "comps.dtd">
    <comps>
      <group>
        <id>cosmic-desktop</id>
        <name>Cosmic Desktop</name>
        <description>System76 Cosmic Desktop Environment</description>
        <default>false</default>
        <uservisible>true</uservisible>
        <packagelist>
          <packagereq type="mandatory">cosmic-desktop</packagereq>
          <packagereq type="mandatory">cosmic-workspaces-daemon</packagereq>
          <packagereq type="mandatory">cosmic-launcher</packagereq>
          <packagereq type="mandatory">cosmic-panel</packagereq>
          <packagereq type="mandatory">cosmic-settings</packagereq>
          <packagereq type="mandatory">cosmic-applets</packagereq>
          <packagereq type="mandatory">cosmic-session</packagereq>
          <packagereq type="mandatory">cosmic-greeter</packagereq>
          <packagereq type="default">cosmic-icontheme</packagereq>
          <packagereq type="default">cosmic-terminal</packagereq>
          <packagereq type="default">cosmic-files</packagereq>
          <packagereq type="default">cosmic-settings-daemon</packagereq>
          <packagereq type="default">cosmic-design</packagereq>
          <packagereq type="default">cosmic-screenshot</packagereq>
          <packagereq type="default">cosmic-applibrary</packagereq>
          <packagereq type="default">cosmic-notifications</packagereq>
        </packagelist>
      </group>
    </comps>
    EOF
    
    # Register the group
    createrepo_c --update --compress-type=zstd --groupfile=/tmp/cosmic-group.xml /var/cache/dnf
  fi
  
  echo "COSMIC repository setup complete"
